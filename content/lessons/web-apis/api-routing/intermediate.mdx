# API Routing Deep Dive

ASP.NET Core uses **attribute routing** for Web APIs, where routes are defined using attributes directly on controllers and actions. This provides explicit, maintainable route definitions.

## Route Template Syntax

<RoutingAttributeExplorer mode="intermediate" />

## Route Tokens

Special tokens get replaced at runtime:

| Token          | Replacement                               |
| :------------- | :---------------------------------------- |
| `[controller]` | Controller name minus "Controller" suffix |
| `[action]`     | Action method name                        |
| `[area]`       | Area name (if using areas)                |

```csharp
[Route("api/[controller]")]
public class ProductsController : ControllerBase
{
    // Route becomes: api/products
}
```

## Route Parameters

### Required Parameters

```csharp
[HttpGet("{id}")]
public ActionResult<Product> GetById(int id)
    => Ok(_service.GetById(id));
```

### Optional Parameters

```csharp
[HttpGet("{id?}")]
public ActionResult GetById(int? id)
{
    if (id.HasValue)
        return Ok(_service.GetById(id.Value));
    return Ok(_service.GetAll());
}
```

### Default Values

```csharp
[HttpGet("{page=1}")]
public ActionResult<List<Product>> GetAll(int page)
    => Ok(_service.GetAll(page));
```

## Route Constraints

Constrain parameter types and formats:

```csharp
// Only matches integer IDs
[HttpGet("{id:int}")]
public ActionResult<Product> GetById(int id) { }

// Only matches GUIDs
[HttpGet("{id:guid}")]
public ActionResult<Product> GetByGuid(Guid id) { }

// Minimum value constraint
[HttpGet("{id:int:min(1)}")]
public ActionResult<Product> GetById(int id) { }

// Regex constraint
[HttpGet("{slug:regex(^[a-z0-9-]+$)}")]
public ActionResult<Product> GetBySlug(string slug) { }
```

### Common Constraints

| Constraint  | Description     | Example            |
| :---------- | :-------------- | :----------------- |
| `int`       | Integer         | `{id:int}`         |
| `guid`      | GUID format     | `{id:guid}`        |
| `min(n)`    | Minimum value   | `{id:min(1)}`      |
| `max(n)`    | Maximum value   | `{id:max(100)}`    |
| `length(n)` | Exact length    | `{code:length(6)}` |
| `alpha`     | Letters only    | `{name:alpha}`     |
| `required`  | Must have value | `{name:required}`  |

## Query String Parameters

Parameters not in the route come from query string:

```csharp
// GET /api/products?category=electronics&minPrice=100
[HttpGet]
public ActionResult<List<Product>> Search(
    string? category,
    decimal? minPrice,
    decimal? maxPrice,
    int page = 1,
    int pageSize = 10)
{
    return Ok(_service.Search(category, minPrice, maxPrice, page, pageSize));
}
```

## Multiple Routes

Actions can have multiple routes:

```csharp
[HttpGet]
[Route("")] // /api/products
[Route("all")] // /api/products/all
[Route("~/products")] // /products (absolute)
public ActionResult<List<Product>> GetAll() { }
```

<ProgressCheckpoint section="routing-intermediate" xpReward={40} />
