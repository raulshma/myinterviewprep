# Optimizing JOIN Operations: Practical Patterns

Real-world JOIN optimization techniques.

## Understanding JOIN Algorithms

```sql
-- Nested Loop: Best for small outer table
SELECT * FROM small_table s
JOIN large_table l ON s.id = l.foreign_id;

-- Hash Join: Best for large tables without sorted keys
SELECT * FROM orders o
JOIN customers c ON o.customer_id = c.id;

-- Merge Join: Best when both sides are sorted
SELECT * FROM sorted_orders o
JOIN sorted_customers c ON o.customer_id = c.id;
```

## Filter Early

```sql
-- BAD: Filter after JOIN (processes all rows)
SELECT o.*, c.name
FROM orders o
JOIN customers c ON o.customer_id = c.id
WHERE o.order_date > '2024-01-01';

-- GOOD: Filter in subquery (fewer rows to join)
SELECT o.*, c.name
FROM (SELECT * FROM orders WHERE order_date > '2024-01-01') o
JOIN customers c ON o.customer_id = c.id;
```

## Reduce Result Set Before JOIN

```sql
-- Aggregate before joining
SELECT c.name, o.order_count
FROM customers c
JOIN (
    SELECT customer_id, COUNT(*) AS order_count
    FROM orders
    GROUP BY customer_id
) o ON c.id = o.customer_id;

-- Instead of joining all orders then grouping
```

## Avoid Unnecessary JOINs

```sql
-- BAD: Join if you just need existence check
SELECT * FROM orders o
JOIN customers c ON o.customer_id = c.id;

-- GOOD: If you just need order data
SELECT * FROM orders o
WHERE EXISTS (SELECT 1 FROM customers c WHERE c.id = o.customer_id);
```

## Multiple Table JOINs

```sql
-- Provide indexes for all join columns
CREATE INDEX IX_oi_order ON order_items(order_id);
CREATE INDEX IX_oi_product ON order_items(product_id);

SELECT o.id, p.name, oi.quantity
FROM orders o
JOIN order_items oi ON o.id = oi.order_id
JOIN products p ON oi.product_id = p.id
WHERE o.customer_id = 123;
```

## Semi-Joins with EXISTS

```sql
-- Find customers with orders (more efficient than JOIN + DISTINCT)
SELECT c.*
FROM customers c
WHERE EXISTS (
    SELECT 1 FROM orders o WHERE o.customer_id = c.id
);
```

<QueryOptimizer mode="intermediate" />

<ProgressCheckpoint section="optimizing-joins-complete" xpReward={40} />
