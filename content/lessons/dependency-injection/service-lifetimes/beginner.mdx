# Service Lifetimes: Singleton, Scoped, Transient

Remember our restaurant analogy? Let's use it to understand the three "lifetimes" a service can have! ğŸ½ï¸

## The Restaurant Staff Analogy

Think about different types of workers in a restaurant:

<ServiceLifetimeDemo mode="beginner" />

| Lifetime         | Restaurant Analogy | Behavior                                    |
| :--------------- | :----------------- | :------------------------------------------ |
| **Singleton** ğŸ’œ | Head Chef ğŸ‘¨â€ğŸ³       | ONE person, works all day for everyone      |
| **Scoped** ğŸ’™    | Personal Waiter ğŸ§‘â€ğŸ’¼ | ONE per table/group, serves that group only |
| **Transient** ğŸ’š | Napkins ğŸ§»         | Fresh one EVERY time you ask                |

## Singleton: One for Everyone

<InfoBox type="tip">
  **Singleton** = Created ONCE, shared by the ENTIRE application forever.
</InfoBox>

Think of it like:

- ğŸ‘¨â€ğŸ³ The **head chef** - one person cooking for all customers
- ğŸ“‹ The **menu board** - one board everyone reads
- ğŸ”§ The **kitchen equipment** - shared by all staff

```csharp
// This logger is shared by everyone in the app!
builder.Services.AddSingleton<ILogger, ConsoleLogger>();
```

**Good for:**

- âœ… Configuration settings (they don't change)
- âœ… Logging (write to one place)
- âœ… Expensive resources (database connection pools)

## Scoped: One per Table (Request)

<InfoBox type="tip">
  **Scoped** = Created ONCE per "request", shared within that request.
</InfoBox>

Think of it like:

- ğŸ§‘â€ğŸ’¼ Your **personal waiter** - serves your table throughout your meal
- ğŸ“ Your **order slip** - used for your table's entire visit
- ğŸ· Your **table number** - assigned when you arrive, gone when you leave

```csharp
// New DbContext for each HTTP request!
builder.Services.AddScoped<AppDbContext>();
```

**Good for:**

- âœ… Database contexts (one transaction per request)
- âœ… Shopping carts (tracks one user's session)
- âœ… Current user info (same user throughout request)

## Transient: Fresh Every Time

<InfoBox type="tip">
  **Transient** = Created NEW every single time it's requested.
</InfoBox>

Think of it like:

- ğŸ§» **Napkins** - fresh one every time you ask
- ğŸ¥¢ **Chopsticks** - new pair for each dish
- ğŸ§¾ **Receipts** - printed new each time

```csharp
// Brand new email service for every injection!
builder.Services.AddTransient<IEmailService, SmtpEmailService>();
```

**Good for:**

- âœ… Lightweight services (quick to create)
- âœ… Stateless operations (no data between calls)
- âœ… When you need isolation (separate instances)

## Quick Memory Trick ğŸ§ 

| Lifetime      | How Long It Lives           | Remember It As                              |
| :------------ | :-------------------------- | :------------------------------------------ |
| **Singleton** | App start â†’ App stop        | "**S**ingleton = **S**tays forever"         |
| **Scoped**    | Request start â†’ Request end | "**Sc**oped = **Sc**reen refresh = new one" |
| **Transient** | Created â†’ Used â†’ Gone       | "**T**ransient = **T**hrow away after use"  |

## Registration Cheat Sheet

```csharp
// In Program.cs

// ğŸ’œ Singleton - ONE instance FOREVER
builder.Services.AddSingleton<ILogger, ConsoleLogger>();

// ğŸ’™ Scoped - ONE instance per REQUEST
builder.Services.AddScoped<IShoppingCart, ShoppingCart>();

// ğŸ’š Transient - NEW instance EVERY TIME
builder.Services.AddTransient<IEmailService, SmtpEmailService>();
```

## Key Takeaways

- ğŸ’œ **Singleton** = Head Chef - one for the whole restaurant (app)
- ğŸ’™ **Scoped** = Personal Waiter - one per table (request)
- ğŸ’š **Transient** = Napkins - fresh every time you ask
- ğŸ—ƒï¸ Use **Scoped for database** contexts (most common!)

<ProgressCheckpoint section="lifetime-overview" xpReward={25} />
