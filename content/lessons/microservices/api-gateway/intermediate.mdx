# API Gateway Pattern

An API Gateway acts as a reverse proxy that routes requests from clients to services, handling cross-cutting concerns like authentication, rate limiting, and request aggregation.

## Interactive Gateway Visualization

<ApiGatewaySimulator mode="intermediate" />

## Gateway Responsibilities

### 1. Request Routing

The gateway routes incoming requests to appropriate backend services:

```
Client Request                    Gateway                    Services
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GET /api/products/123      â†’     Route matching      â†’     Catalog Service
POST /api/orders           â†’     Route matching      â†’     Order Service
GET /api/users/me          â†’     Route matching      â†’     User Service
```

### 2. Authentication & Authorization

Centralized security handling:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â”‚  (with JWT) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            API Gateway               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   1. Extract JWT token         â”‚  â”‚
â”‚  â”‚   2. Validate signature        â”‚  â”‚
â”‚  â”‚   3. Check expiration          â”‚  â”‚
â”‚  â”‚   4. Verify permissions        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ (if valid)
                   â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚    Microservice â”‚
          â”‚  (trusts gateway)â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Rate Limiting

Protect services from being overwhelmed:

| Strategy | Description | Use Case |
| :--- | :--- | :--- |
| Fixed Window | X requests per time window | Simple rate limiting |
| Sliding Window | Smooth rate limiting | Avoid burst at window edges |
| Token Bucket | Allows bursts up to limit | Handling traffic spikes |
| Leaky Bucket | Processes at fixed rate | Consistent throughput |

### 4. Request Aggregation

Combine multiple service calls into one:

```
Client Request: GET /api/dashboard

Gateway internally calls:
  â†’ User Service:    GET /api/users/123
  â†’ Order Service:   GET /api/orders?userId=123&limit=5
  â†’ Catalog Service: GET /api/recommendations/123

Gateway Response: {
  "user": { ... },
  "recentOrders": [ ... ],
  "recommendations": [ ... ]
}
```

## BFF Pattern (Backend for Frontend)

Different clients have different needs. The BFF pattern creates specialized gateways:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Mobile App â”‚    â”‚   Web App   â”‚    â”‚  Admin App  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚                  â”‚
       â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Mobile BFF  â”‚    â”‚   Web BFF   â”‚    â”‚  Admin BFF  â”‚
â”‚  (compact)  â”‚    â”‚   (rich)    â”‚    â”‚  (full)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚                  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚     Microservices     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Benefits:**
- Mobile BFF returns minimal data (bandwidth)
- Web BFF returns rich data (better UX)
- Each BFF can be maintained by its frontend team

## Common Gateway Features

| Feature | Description |
| :--- | :--- |
| **SSL Termination** | Gateway handles HTTPS, internal traffic is HTTP |
| **Load Balancing** | Distributes requests across service instances |
| **Caching** | Reduces calls to backend services |
| **Request/Response Transform** | Modify headers, body format |
| **Circuit Breaker** | Prevents cascading failures |
| **Logging & Monitoring** | Centralized observability |

## Gateway Technologies Comparison

| Gateway | Type | Best For |
| :--- | :--- | :--- |
| **Ocelot** | .NET Library | .NET microservices |
| **YARP** | .NET Library | Modern .NET reverse proxy |
| **Kong** | Standalone | Platform-agnostic |
| **AWS API Gateway** | Cloud Service | Serverless/AWS |
| **Azure API Management** | Cloud Service | Enterprise/Azure |
| **NGINX** | Reverse Proxy | High performance |

## Gateway Anti-Patterns

### âŒ Overloaded Gateway
Don't put business logic in the gateway!

```
// BAD - Business logic in gateway
if (order.Total > 1000) {
    applyDiscount(order, 0.1);
}
```

### âŒ Single Point of Failure
Don't run just one gateway instance!

```
// GOOD - Multiple gateway instances behind load balancer
Load Balancer
    â”œâ”€â”€ Gateway Instance 1
    â”œâ”€â”€ Gateway Instance 2
    â””â”€â”€ Gateway Instance 3
```

## Key Takeaways

- ğŸšª Gateway is the **single entry point** for external clients
- ğŸ” Centralizes **authentication and authorization**
- ğŸš¦ Handles **rate limiting** to protect services
- ğŸ“¦ **BFF Pattern** provides client-specific gateways
- âš ï¸ Don't put **business logic** in the gateway
- ğŸ”„ Run **multiple instances** for high availability

<ProgressCheckpoint section="ag-gateway-features" xpReward={45} />
